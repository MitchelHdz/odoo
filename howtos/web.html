<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <title>Extendiendo la Interfaz &mdash; documentación de odoo - 10.0</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/patchqueue.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '10.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <link rel="top" title="documentación de odoo - 10.0" href="../index.html" />
    <link rel="up" title="Tutoriales" href="../tutorials.html" />
    <link rel="next" title="Servicios Web (API)" href="../api_integration.html" />
    <link rel="prev" title="Construyendo un Módulo" href="backend.html" /> 
  </head>
  <body role="document"><header class="o_main_header o_has_sub_nav o_inverted ">
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting/">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management/">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">Extendiendo la Interfaz</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            

<li><a href="http://www.odoo.com/documentation/user/10.0/index.html">User</a></li>
<li><a href="http://www.odoo.com/documentation/10.0/index.html">Developer</a></li>
<li><a href="http://www.odoo.com/documentation/10.0/api_integration.html">API</a></li>
<li><a href="http://www.odoo.com/documentation/10.0/setup/install.html">Installation</a></li>
<li><a href="http://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="http://www.odoo.com/page/legal">Legal</a></li>
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/build_interface_ext.jpg');"></span>
      <div class="container text-center">
        <h1> Extendiendo la Interfaz </h1>
      </div>
    </figure>
    
    
    
    <div class="container ">
      <main class="container-fluid ">
        
        <div class="row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="list-group text-left nav"><li class="list-group-item"><a href="#a-simple-module" class="ripple internal reference">Un módulo sencillo</a></li><li class="list-group-item"><a href="#odoo-javascript-module" class="ripple internal reference">Odoo módulo en JavaScript</a></li><li class="list-group-item"><a href="#classes" class="ripple internal reference">Clases</a></li><li class="list-group-item"><a href="#widgets-basics" class="ripple internal reference">Conceptos básicos de widgets</a><ul ><li class="list-group-item"><a href="#your-first-widget" class="ripple internal reference">Tu Widget</a></li><li class="list-group-item"><a href="#display-content" class="ripple internal reference">Mostrar Contenido</a></li><li class="list-group-item"><a href="#widget-parents-and-children" class="ripple internal reference">Padres e hijos del widget</a></li><li class="list-group-item"><a href="#destroying-widgets" class="ripple internal reference">Destrucción de Widgets</a></li></ul></li><li class="list-group-item"><a href="#the-qweb-template-engine" class="ripple internal reference">El motor de la plantilla de QWeb</a><ul ><li class="list-group-item"><a href="#using-qweb" class="ripple internal reference">Utilizar QWeb</a><ul ><li class="list-group-item"><a href="#qweb-context" class="ripple internal reference">Contexto QWeb</a></li><li class="list-group-item"><a href="#template-declaration" class="ripple internal reference">Declaración de la plantilla</a></li><li class="list-group-item"><a href="#escaping" class="ripple internal reference">Escape</a></li><li class="list-group-item"><a href="#outputting-html" class="ripple internal reference">Produciendo HTML</a></li><li class="list-group-item"><a href="#conditionals" class="ripple internal reference">Condicionales</a></li><li class="list-group-item"><a href="#iteration" class="ripple internal reference">Iteración</a></li><li class="list-group-item"><a href="#defining-attributes" class="ripple internal reference">Definir atributos</a></li><li class="list-group-item"><a href="#calling-other-templates" class="ripple internal reference">Llamar a otras plantillas</a></li><li class="list-group-item"><a href="#to-learn-more-about-qweb" class="ripple internal reference">Para obtener más información acerca de la</a></li><li class="list-group-item"><a href="#exercise" class="ripple internal reference">Ejercicio</a></li></ul></li></ul></li><li class="list-group-item"><a href="#widget-helpers" class="ripple internal reference">Ayudantes de widget</a><ul ><li class="list-group-item"><a href="#widget-s-jquery-selector" class="ripple internal reference">JQuery Selector de <code >Widget</code></a></li><li class="list-group-item"><a href="#easier-dom-events-binding" class="ripple internal reference">Asignar eventos del DOM</a></li></ul></li><li class="list-group-item"><a href="#widget-events-and-properties" class="ripple internal reference">Propiedades y eventos de widget</a><ul ><li class="list-group-item"><a href="#events" class="ripple internal reference">Eventos</a></li><li class="list-group-item"><a href="#properties" class="ripple internal reference">Propiedades</a></li><li class="list-group-item"><a href="#id3" class="ripple internal reference">Ejercicio</a></li></ul></li><li class="list-group-item"><a href="#modify-existing-widgets-and-classes" class="ripple internal reference">Modificar las clases y los widgets existentes</a></li><li class="list-group-item"><a href="#translations" class="ripple internal reference">Traducciones</a></li><li class="list-group-item"><a href="#communication-with-the-odoo-server" class="ripple internal reference">Comunicación con el servidor de Odoo</a><ul ><li class="list-group-item"><a href="#contacting-models" class="ripple internal reference">Ponerse en contacto con modelos</a></li><li class="list-group-item"><a href="#compoundcontext" class="ripple internal reference">CompoundContext</a></li><li class="list-group-item"><a href="#queries" class="ripple internal reference">Consultas</a></li></ul></li><li class="list-group-item"><a href="#exercises" class="ripple internal reference">Ejercicios</a></li><li class="list-group-item"><a href="#existing-web-components" class="ripple internal reference">Componentes de web existentes</a><ul ><li class="list-group-item"><a href="#the-action-manager" class="ripple internal reference">El director de acción</a><ul ><li class="list-group-item"><a href="#using-the-action-manager" class="ripple internal reference">Mediante el administrador de la acciones</a></li></ul></li><li class="list-group-item"><a href="#client-actions" class="ripple internal reference">Acciones de cliente</a></li><li class="list-group-item"><a href="#architecture-of-the-views" class="ripple internal reference">Arquitectura de las vistas</a><ul ><li class="list-group-item"><a href="#the-view-manager" class="ripple internal reference">El “<em >View Manager</em>” (Manejador de vistas)</a></li><li class="list-group-item"><a href="#the-views" class="ripple internal reference">Las Vistas</a></li></ul></li><li class="list-group-item"><a href="#the-form-view-fields" class="ripple internal reference">Los campos de la vista formulario</a><ul ><li class="list-group-item"><a href="#creating-a-new-type-of-field" class="ripple internal reference">Crear un nuevo tipo de campo.</a><ul ><li class="list-group-item"><a href="#simple-read-only-field" class="ripple internal reference">Campos solo lectura Simples</a></li><li class="list-group-item"><a href="#read-write-field" class="ripple internal reference">Campos de Lectura/Escritura</a></li></ul></li></ul></li><li class="list-group-item"><a href="#the-form-view-custom-widgets" class="ripple internal reference">Los Widgets personalizados en los formularios</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/10.0/doc/howtos/web.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="building-interface-extensions"><p >Ésta guía trata sobre la creación de módulos para la interfaz web de Odoo.</p><p >Para crear sitios web con Odoo, ver <a href="website.html" class="internal reference"><span class="doc">Construyendo un Website</span></a>; para añadir capacidades de negocio o ampliar sistemas de negocio existentes de Odoo, ver <a href="backend.html" class="internal reference"><span class="doc">Construyendo un Módulo</span></a>.</p><div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p >Este manual supone los siguientes conocimientos previos:</p><ul ><li ><p >Conceptos básicos de JavaScript y buenas prácticas</p></li><li ><a href="http://jquery.org" class="external reference alert-link">jQuery</a></li><li ><a href="http://underscorejs.org" class="external reference alert-link">Underscore.js</a></li></ul><p >También requiere <a href="../setup/install.html#setup-install" class="internal alert-link reference"><span class="std std-ref">tener Odoo instalado</span></a> y <a href="http://git-scm.com" class="external reference alert-link">Git</a>.</p></div></section><section id="a-simple-module"><h2 >Un módulo sencillo</h2><p >Vamos a empezar con un módulo sencillo de Odoo con la configuración básica del componente web, que nos permita probar el framework web.</p><p >El módulo ejemplo está disponible en línea y puede descargarse usando el siguiente comando:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> git clone http://github.com/odoo/petstore
</pre></div>
</div>
<p >This will create a <code >petstore</code> folder wherever you executed the command.
You then need to add that folder to Odoo's
<a href="../reference/cmdline.html#cmdoption-odoo-bin--addons-path" class="internal reference"><code class="std xref std-option">addons path</code></a>, create a new database and
install the <code >oepetstore</code> module.</p><p >Si navegas a la carpeta <code >petstore</code> , deberías ver el siguiente contenido:</p><div class="highlight-text"><div class="highlight"><pre><span></span>oepetstore
|-- images
|   |-- alligator.jpg
|   |-- ball.jpg
|   |-- crazy_circle.jpg
|   |-- fish.jpg
|   `-- mice.jpg
|-- __init__.py
|-- oepetstore.message_of_the_day.csv
|-- __manifest__.py
|-- petstore_data.xml
|-- petstore.py
|-- petstore.xml
`-- static
    `-- src
        |-- css
        |   `-- petstore.css
        |-- js
        |   `-- petstore.js
        `-- xml
            `-- petstore.xml
</pre></div>
</div>
<p >El módulo tiene ya varias personalizaciones de servidor. Regresaremos a estos más adelante, por ahora vamos a centrarnos en el contenido relacionado con la web, en la carpeta  <code >static</code>.</p><p >Los archivos utilizados en el lado &quot;web&quot; de un módulo Odoo deben colocarse en una carpeta <code >static</code>, para que estén disponibles en el explorador web, los archivos fuera de esa carpeta no pueden ser descargados por los navegadores. El nombre que tienen los subdirectorios <code >src/css</code>, <code >src/js</code> and <code >src/xml</code> es por convención y no es estrictamente necesario.</p><dl ><dt ><code >oepetstore/static/css/petstore.css</code></dt><dd ><p >Actualmente vacío, contendrá los <a href="http://www.w3.org/Style/CSS/Overview.en.html" class="external reference">CSS</a> de la tienda de mascotas</p></dd><dt ><code >oepetstore/static/xml/petstore.xml</code></dt><dd ><p >En su mayor parte vacío, contendrá las plantillas <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span class="std std-ref">QWeb</span></a></p></dd><dt ><code >oepetstore/static/js/petstore.js</code></dt><dd ><p >La parte más importante (e interesante), contiene la lógica de la aplicación (o al menos del lado del navegador) como javascript. Actualmente debería verse como:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl><p >El cual sólo imprime un pequeño mensaje en la consola del explorador.</p><p >The files in the <code >static</code> folder, need to be defined within the module in order for them to be loaded correctly. Everything in <code >src/xml</code> is defined in <code >__manifest__.py</code> while the contents of <code >src/css</code> and <code >src/js</code> are defined in <code >petstore.xml</code>, or a similar file.</p><div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p >Se concatenan todos los archivos JavaScript y son minificados (<a href="../glossary.html#term-minified" class="internal alert-link reference"><span class="std std-term xref">minified</span></a>) para reducir el tiempo de carga de la aplicación.</p><p >Uno de los inconvenientes es que la depuración se hace más difícil cuando los archivos individuales desaparecen y por ende el código se hace significativamente menos legible. Es posible deshabilitar este proceso activando el &quot;modo desarrollador&quot;: para ello inicie sesión en la instancia Odoo (usuario <em >admin</em> contraseña <em >admin</em> por defecto), abra el menú de usuario (en la esquina superior derecha de la pantalla de Odoo) y seleccione <span class="guilabel">About</span>, luego haz click en <span class="guilabel">Activate the developer mode</span>:</p><img src="../_images/about_odoo.png" class="img-responsive center-block"><img src="../_images/devmode.png" class="img-responsive center-block"><p >Esto volverá a cargar al cliente web con las optimizaciones deshabilitadas, y hará que el desarrollo y la depuración sea más cómodo.</p></div></section><section id="odoo-javascript-module"><h2 >Odoo módulo en JavaScript</h2><p >JavaScript no tiene módulos incorporados. Como resultado, las variables definidas en archivos diferentes son todos tratadas juntas y pueden entrar en conflicto. Esto ha dado lugar a diversos patrones de módulo usados para construir los espacios de nombres limpios y limitar los riesgos de conflictos de nombres.</p><p >El esquema de desarrollo en Odoo utiliza un patrón para definir módulos web, para manejar los espacios de nombres y así cargarlos correctamente.</p><p ><code >oepetstore/static/js/petstore.js</code> contiene una declaración de módulo:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">local</span><span class="p">.</span><span class="nx">xxx</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">}</span>
</pre></div>
</div>
<p >In Odoo web, modules are declared as functions set on the global <code >odoo</code>
variable. The function's name must be the same as the addon (in this case
<code >oepetstore</code>) so the framework can find it, and automatically initialize it.</p><p >Cuando el cliente web se carga el módulo llama a la función raíz y envía dos parámetros:</p><ul ><li ><p >el primer parámetro es la instancia actual del cliente web de Odoo, da acceso a varias de las capacidades definidas por Odoo (traducciones, servicios de red) así como de objetos definidos por la base o por otros módulos.</p></li><li ><p >el segundo parámetro es su propio espacio de nombres local creado automáticamente por el cliente web. Objetos y variables que deben ser accesibles desde fuera de su módulo (o bien porque el cliente de web de Odoo tiene que llamar a los otros para personalizarlos) deben ajustarse dentro de ese espacio de nombres.</p></li></ul></section><section id="classes"><h2 >Clases</h2><p >Tanto como módulos y contrario a lenguajes más orientados a objetos, javascript no construye <em >clases</em> <a href="#id4" class="footnote-ref" id="id1">1</a> aunque provee un mecanismo equivalente (de menor nivel y más detallado).</p><p >Por simplicidad y ayuda al desarrollador Odoo web ofrece un sistema de clases basado en  <a href="http://ejohn.org/blog/simple-javascript-inheritance/" class="external reference">Simple JavaScript Inheritance</a> de John Resig.</p><p >New classes are defined by calling the <code class="js-func xref js">extend()</code>
method of <code class="js-class xref js">odoo.web.Class()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >The <code class="js-func xref js">extend()</code> method takes a dictionary describing
the new class's content (methods and static attributes). In this case, it will
only have a <code >say_hello</code> method which takes no parameters.</p><p >Las clases son instanciadas usando el operador <code >new</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello&quot; in the console</span>
</pre></div>
</div>
<p >Y atributos de la instancia pueden accederse a través de  <code >this</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span><span class="p">;</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
</div>
<p >Las clases pueden proporcionar un inicializador para realizar la configuración inicial de la instancia, mediante la definición de un método <code >init()</code>. El inicializador recibe los parámetros pasados al usar el operador <code >new</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
</div>
<p >It is also possible to create subclasses from existing (used-defined) classes
by calling <code class="js-func xref js">extend()</code> on the parent class, as is done
to subclass <code class="js-class xref js">Class()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hola Bob&quot; in the console</span>
</pre></div>
</div>
<p >Cuando sobreescribes un método usando herencia, puede utilizar <code >this._super()</code> para llamar al método original:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;translation in Spanish: hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob \n translation in Spanish: hola Bob&quot; in the console</span>
</pre></div>
</div>
<div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p ><code >_super</code> no es un método estándar, es creado sobre la marcha para el próximo método de la cadena actual de la herencia, si hay alguno. Sólo se define durante la parte <em >síncrona</em> de una llamada al método, para su uso en controladores asincrónicos (después de llamadas de red o en las devoluciones de llamada <code >setTimeout</code>) una referencia a su valor será retenida, no debe accederse a través de <code >this</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// broken, will generate an error</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// correct</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// don&#39;t forget .bind()</span>
    <span class="kd">var</span> <span class="nx">_super</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></section><section id="widgets-basics"><h2 >Conceptos básicos de widgets</h2><p >El cliente web Odoo contiene <a href="http://jquery.org" class="external reference">jQuery</a> para una sencilla manipulación del DOM. Es útil y proporciona una API mejor que el estándar <a href="http://www.w3.org/TR/DOM-Level-3-Core/" class="external reference">W3C DOM</a><a href="#dombugs" class="footnote-ref" id="id2">2</a>, pero insuficiente para aplicaciones de estructura compleja complicando su mantenimiento.</p><p >Much like object-oriented desktop UI toolkits (e.g. <a href="http://qt-project.org" class="external reference">Qt</a>, <a href="https://developer.apple.com/technologies/mac/cocoa.html" class="external reference">Cocoa</a> or <a href="http://www.gtk.org" class="external reference">GTK</a>),
Odoo Web makes specific components responsible for sections of a page. In
Odoo web, the base for such components is the <code class="js-class xref js">Widget()</code>
class, a component specialized in handling a page section and displaying
information for the user.</p></section><section id="your-first-widget"><h3 >Tu Widget</h3><p >El módulo demostración inicial ya proporciona un widget básico:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >It extends <code class="js-class xref js">Widget()</code> and overrides the standard method
<code class="js-func xref js">start()</code>, which — much like the previous <code >MyClass</code>
— does little for now.</p><p >Esta línea al final del archivo:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
    <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p >registra nuestro widget básico como una acción del cliente. Las acciones de cliente se explicará más adelante, por ahora esto es sólo lo que permite llamar a nuestro widget y que  aparezca cuando seleccionamos la <span class="menuselection">Pet Store ‣ Pet Store ‣ Home Page</span> menú.</p><div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p >ya que el widget se llama desde fuera de nuestro módulo, el cliente web necesita su nombre  &quot;fully qualified&quot;, no la versión local.</p></div></section><section id="display-content"><h3 >Mostrar Contenido</h3><p >Widgets tienen un número de características y métodos, pero los conceptos básicos son simples:</p><ul ><li ><p >crear un widget</p></li><li ><p >formatear los datos del widget</p></li><li ><p >Mostrar el widget</p></li></ul><p >The <code >HomePage</code> widget already has a <code class="js-func xref js">start()</code>
method. That method is part of the normal widget lifecycle and automatically
called once the widget is inserted in the page. We can use it to display some
content.</p><p >All widgets have a <code class="js-attr xref js">$el</code> which represents the
section of page they're in charge of (as a <a href="http://jquery.org" class="external reference">jQuery</a> object). Widget content
should be inserted there. By default, <code class="js-attr xref js">$el</code> is an
empty <code >&lt;div&gt;</code> element.</p><p >El elemento <code >&lt;div&gt;</code> está generalmente invisible para el usuario si no tiene nada de contenido (o sin estilos específicos, que le dan un tamaño) razón por la cual nada se muestra en la página cuando el  <code >HomePage</code> el llamado.</p><p >Vamos a añadir algunos contenidos al elemento raíz del widget usando jQuery:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Este mensaje aparecerá cuando se abre <span class="menuselection">Pet Store ‣ Pet Store ‣ Home Page</span></p><div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >para actualizar el código javascript que se cargan en Odoo Web, solo necesitas volver a cargar la página. No hay que reiniciar el servidor de Odoo.</p></div><p >El widget del <code >HomePage</code> es utilizado por Odoo Web y gestionado automáticamente. Para aprender a usar un widget “desde cero“ vamos a crear uno nuevo:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;We are so happy to see you again in this menu!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >We can now add our <code >GreetingsWidget</code> to the <code >HomePage</code> by using the
<code >GreetingsWidget</code>'s <code class="js-func xref js">appendTo()</code> method:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<ul ><li ><p ><code >HomePage</code> primero agrega su propio contenido a la raíz DOM</p></li><li ><p ><code >HomePage</code> luego crea una instancia de  <code >GreetingsWidget</code></p></li><li >Finally it tells <code >GreetingsWidget</code> where to insert itself, delegating part
of its <code class="js-attr xref js">$el</code> to the <code >GreetingsWidget</code>.</li></ul><p >When the <code class="js-func xref js">appendTo()</code> method is called, it asks the
widget to insert itself at the specified position and to display its content.
The <code class="js-func xref js">start()</code> method will be called during the call
to <code class="js-func xref js">appendTo()</code>.</p><p >To see what happens under the displayed interface, we will use the browser's
DOM Explorer. But first let's alter our widgets slightly so we can more easily
find where they are, by <code class="js-attr xref js">adding a class to their root elements</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_homepage&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
<span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_greetings&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Si puedes encontrar la sección relevante del DOM (haga clic derecho sobre el texto a continuación <span class="guilabel">Inspect Element</span>), debe lucir así:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Hello dear Odoo user!<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;oe_petstore_greetings&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>We are so happy to see you again in this menu!<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p >Which clearly shows the two <code >&lt;div&gt;</code> elements automatically created by
<code class="js-class xref js">Widget()</code>, because we added some classes on them.</p><p >También podemos ver los dos divs que añadimos nosotros mismos</p><p >Por último, tenga en cuenta que el elemento <code >&lt;div class=&quot;oe_petstore_greetings&quot;&gt;</code> representa la instancia <code >GreetingsWidget</code> que está dentro de <code >&lt;div class=&quot;oe_petstore_homepage&quot;&gt;</code> que representa la instancia <code >HomePage</code>, la cual lo agrega</p></section><section id="widget-parents-and-children"><h3 >Padres e hijos del widget</h3><p >En la parte anterior, creamos una instancia de un widget usando esta sintaxis:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</pre></div>
</div>
<p >El primer argumento es <code >this</code>, que en ese caso fue una instancia de  <code >HomePage</code> . Esto indica que el widget se crea otro widget el cual es su <em >padre</em>.</p><p >Como hemos visto, widgets generalmente se insertan en el DOM por otro widget y <em >dentro</em> el elemento de raíz de otro widget. Esto significa que la mayoría de los widgets son “parte” de otro widget y existe en el nombre de él. Llamamos el contenedor el <em >padre</em> y el widget contenido el <em >hijo</em>.</p><p >Debido a múltiples razones técnicas y conceptuales, es necesaria para un widget saber quién es su padre y cuales son sus hijos.</p><dl ><dt ><code class="js-func xref js">getParent()</code></dt><dd ><p >puede utilizarse para obtener el padre de un widget:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getParent</span><span class="p">().</span><span class="nx">$el</span> <span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_homepage&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd><dt ><code class="js-func xref js">getChildren()</code></dt><dd ><p >puede utilizarse para obtener una lista de sus hijos:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">$el</span><span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_greetings&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl><p >When overriding the <code class="js-func xref js">init()</code> method of a widget it is
<em >of the utmost importance</em> to pass the parent to the <code >this._super()</code> call,
otherwise the relation will not be set up correctly:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Por último, si un widget no tiene un padre (por ejemplo, porque es el widget de la raíz de la aplicación), <code >null</code> puede ser proporcionado como padre:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</pre></div>
</div>
</section><section id="destroying-widgets"><h3 >Destrucción de Widgets</h3><p >If you can display content to your users, you should also be able to erase
it. This is done via the <code class="js-func xref js">destroy()</code> method:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">greeting</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</pre></div>
</div>
<p >When a widget is destroyed it will first call
<code class="js-func xref js">destroy()</code> on all its children. Then it erases itself
from the DOM. If you have set up permanent structures in
<code class="js-func xref js">init()</code> or <code class="js-func xref js">start()</code> which
must be explicitly cleaned up (because the garbage collector will not handle
them), you can override <code class="js-func xref js">destroy()</code>.</p><div role="alert" class="alert-danger alert"><p class="alert-title">Peligro</p><p >when overriding <code class="js-func xref js">destroy()</code>, <code >_super()</code>
<em >must always</em> be called otherwise the widget and its children are not
correctly cleaned up leaving possible memory leaks and &quot;phantom events&quot;,
even if no error is displayed</p></div></section><section id="the-qweb-template-engine"><h2 >El motor de la plantilla de QWeb</h2><p >En la sección anterior agregamos contenido a nuestros widgets directamente manipulando (y agregando a) su DOM:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p >Esto permite generar y visualizar cualquier tipo de contenido, pero es difícil de manejar cuando se generan cantidades significativas de DOM (mucha duplicación, citando problemas,…)</p><p >Como muchos otros ambientes, la solución de Odoo es utilizar un <a href="http://en.wikipedia.org/wiki/Web_template_system" class="external reference">motor de plantilla engine</a>. El motor de plantillas en Odoo se llama <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span class="std std-ref">QWeb</span></a>.</p><p >QWeb es un lenguaje de plantillas basado en XML, similar a <a href="http://en.wikipedia.org/wiki/Genshi_(templating_language)" class="external reference">Genshi</a>, <a href="http://en.wikipedia.org/wiki/Thymeleaf" class="external reference">Thymeleaf</a> o  <a href="http://en.wikipedia.org/wiki/Facelets" class="external reference">Facelets</a>. Este tiene las siguientes características:</p><ul ><li ><p >Se ha implementado completamente en JavaScript y es procesado en el navegador</p></li><li ><p >Cada archivo de plantilla (archivos XML) contiene varias plantillas</p></li><li >It has special support in Odoo Web's <code class="js-class xref js">Widget()</code>, though it
can be used outside of Odoo's web client (and it's possible to use
<code class="js-class xref js">Widget()</code> without relying on QWeb)</li></ul><div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >La razón de utilizar QWeb en vez de los motores de plantilla javascript es la extensibilidad de plantillas preexistentes (tercero), al igual que las <a href="../reference/views.html#reference-views" class="internal alert-link reference"><span class="std std-ref">views</span></a> en Odoo.</p><p >La mayoría de los motores de plantilla javascript son basados en texto que impide la fácil extensibilidad estructural donde un motor de plantillas basado en XML puede ser genéricamente alterada usando por ejemplo usando XPath o CSS y alteración de árbol DSL (o incluso sólo XSLT). Esta flexibilidad y extensibilidad es una característica del núcleo de Odoo y perderlo era considerado inaceptable.</p></div></section><section id="using-qweb"><h3 >Utilizar QWeb</h3><p >Primero vamos a definir una plantilla de QWeb simple en el archivo casi vacío <code >oepetstore/static/src/xml/petstore.xml</code>:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;background-color: red;&quot;</span><span class="nt">&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<p >Ahora podemos usar esta plantilla en el widget del <code >HomePage</code>. Utilizando la variable del cargador  <code >QWeb</code> en la parte superior de la página, podemos llamar a la plantilla definida en el archivo XML:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><code class="js-func xref js">QWeb.render()</code> busca la plantilla especifica, y la convierte a una cadena y devuelve el resultado.</p><p >However, because <code class="js-class xref js">Widget()</code> has special integration for QWeb
the template can be set directly on the widget via its
<code class="js-attr xref js">template</code> attribute:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Aunque el resultado es similar, hay dos diferencias entre estos usos:</p><ul ><li >with the second version, the template is rendered right before
<code class="js-func xref js">start()</code> is called</li><li ><p >en la primera versión el contenido de la plantilla se agrega al elemento de raíz del widget, mientras que en la segunda versión la raíz de la plantilla queda directamente <em >como</em> elemento de raíz del widget. Razón por la cual el sub-widget &quot;greetings&quot; también tiene un fondo rojo</p></li></ul><div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p >templates should have a single non-<code >t</code> root element, especially if
they're set as a widget's <code class="js-attr xref js">template</code>. If there are
multiple &quot;root elements&quot;, results are undefined (usually only the first
root element will be used and the others will be ignored)</p></div></section><section id="qweb-context"><h4 >Contexto QWeb</h4><p >A las plantillas QWeb le puedes pasar datos y éstos pueden contener lógica de visualización básicas.</p><p >Para las llamadas explícitas a <code class="js-func xref js">QWeb.render()</code>, los datos de la plantilla se pasan como segundo parámetro:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Klaus&quot;</span><span class="p">});</span>
</pre></div>
</div>
<p >con la plantilla para modificar:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >dará como resultado:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Hello Klaus<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p >When using <code class="js-class xref js">Widget()</code>'s integration it is not possible to
provide additional data to the template. The template will be given a single
<code >widget</code> context variable, referencing the widget being rendered right
before <code class="js-func xref js">start()</code> is called (the widget's state will
essentially be that set up by <code class="js-func xref js">init()</code>):</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;widget.name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Mordecai&quot;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Resultado:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Hello Mordecai<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
</section><section id="template-declaration"><h4 >Declaración de la plantilla</h4><p >Hemos visto cómo es el <em >procesamiento</em> de plantillas QWeb, ahora veamos la sintaxis de las plantillas.</p><p >Una plantilla de QWeb se compone de XML regular mezclado con <em >directivas</em> QWeb . Se declara una directiva de QWeb con atributos XML que comiencen por ‘’ t-‘’.</p><p >La directiva más básica es <code >t-name</code>, se utiliza para declarar nuevas plantillas en un archivo de plantillas:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;templates&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<p ><code >t-name</code> toma el nombre de la plantilla que se está definiendo y declara que pueda llamarse usando <code class="js-func xref js">QWeb.render()</code>. Sólo se puede utilizar en el nivel superior de un archivo de plantilla.</p></section><section id="escaping"><h4 >Escape</h4><p >La directiva <code >t-esc</code> se puede utilizar para mostrar texto:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<p >Toma una expresión de Javascript que se evalúa, el resultado de la expresión es entonces insertado en el documento y escapado de HTML. Ya que es una expresión, es posible proporcionar sólo un nombre de variable como se ve arriba, o una expresión más compleja como un cálculo:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;3+5&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<p >o el método llama:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name.toUpperCase()&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
</section><section id="outputting-html"><h4 >Produciendo HTML</h4><p >Para inyectar HTML en la página durante el procesamiento, usas <code >t-raw</code>. Como <code >t-esc</code> toma una expresión Javascript arbitraria como parámetro, pero no realiza un paso de escapar el HTML.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-raw=</span><span class="s">&quot;name.link(user_account)&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-danger alert"><p class="alert-title">Peligro</p><p ><code >t-raw</code> <em >no</em> debe ser utilizado en datos que pueda tener contenido no escapado proporcionado por el usuario porque esto conduce a vulnerabilidades <a href="http://en.wikipedia.org/wiki/Cross-site_scripting" class="external reference alert-link">cross-site scripting</a></p></div></section><section id="conditionals"><h4 >Condicionales</h4><p >QWeb puede tener bloques condicionales utilizando <code >t-if`. La Directiva toma una expresión arbitraria, si la expresión es falsa (``false</code>, <code >null</code>, <code >0</code>  o una cadena vacía) se suprime el bloque entero, de lo contrario se muestra.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == true&quot;</span><span class="nt">&gt;</span>
        true is true
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == false&quot;</span><span class="nt">&gt;</span>
        true is not true
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >QWeb no tiene una sentencia “else”, utilice un segundo <code >t-if`</code> con la condición original invertida. Puede que desee guardar la condición en una variable local si se trata de una expresión compleja o costosa.</p></div></section><section id="iteration"><h4 >Iteración</h4><p >Para iterar sobre una lista, use <code >t-foreach</code> y  <code >t-as</code>. <code >t-foreach</code> toma una expresión devolviendo una lista sobre la que se itera y toma <code >t-as</code> para asignar el nombre de la variable para enlazar a cada elemento de la iteración.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;names&quot;</span> <span class="na">t-as=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p ><code >t-foreach</code> puede utilizarse con números y objetos (diccionarios)</p></div></section><section id="defining-attributes"><h4 >Definir atributos</h4><p >QWeb proporciona dos directivas relacionadas para definir atributos calculados: <code class="samp">t-att-<em >name</em></code> y <code class="samp">t-attf-<em >name</em></code>. En cualquier caso, <em >name</em> es el nombre del atributo a crear (por ejemplo, <code >t-att-id</code> define el atributo <code >id</code> después de la representación).</p><p ><code >t-att-</code> toma una expresión javascript cuyo resultado se define como el valor del atributo, que es más útil si todos el valor del atributo se calcula:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div&gt;</span>
    Input your name:
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">t-att-value=</span><span class="s">&quot;defaultName&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p ><code >t-attf-</code> toma una <em >formato de cadena</em>. Una cadena de formato es texto literal con bloques de interpolación dentro de él, un bloque de interpolación es una expresión de javascript entre <code >{{</code> y <code >}}</code>, que será sustituido por el resultado de la expresión. Es más útil para los atributos que son parcialmente literales y parcialmente calculados como una clase:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">t-attf-class=</span><span class="s">&quot;container {{ left ? &#39;text-left&#39; : &#39;&#39; }} {{ extra_class }}&quot;</span><span class="nt">&gt;</span>
    insert content here
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
</section><section id="calling-other-templates"><h4 >Llamar a otras plantillas</h4><p >Las plantillas se pueden dividir en las plantillas (por simplicidad, mantenibilidad, reusabilidad o para evitar anidamiento excesivo markup).</p><p >Esto se hace usando la Directiva de ‘’ t-llamada ‘’, que toma el nombre de la plantilla para representar:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;A&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;B&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;B&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >representación de la plantilla de <code >A</code> resultará en:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p >Plantillas secundarias heredan el contexto de representación de su invocador.</p></section><section id="to-learn-more-about-qweb"><h4 >Para obtener más información acerca de la</h4><p >Para referencias acerca de QWeb, vea <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span class="std std-ref">QWeb</span></a>.</p></section><section id="exercise"><h4 >Ejercicio</h4><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Uso de QWeb en Widgets</p><p >Crear un widget cuyo constructor toma dos parámetros aparte de <code >padre</code>: <code >product_names</code> y <code >color</code>.</p><ul ><li ><p ><code >product_names</code> debe ser un arreglo de cadenas, cada una el nombre de un producto</p></li><li ><p ><code >color</code> es una cadena que contiene un color en CSS color formato (es decir: <code >#000000</code> para el negro).</p></li></ul><p >El widget debe mostrar los nombres de producto uno bajo el otro, cada uno en una caja aparte con un color de fondo con el valor de <code >color</code> y una frontera. Debe utilizar QWeb para representar el HTML. Cualquier CSS necesario debe estar en <code >oepetstore/static/src/css/petstore.css`</code>.</p><p >Utilice el widget en <code >HomePage</code> con media docena productos.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">products</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ProductsWidget</span><span class="p">(</span>
                <span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="s2">&quot;mouse&quot;</span><span class="p">,</span> <span class="s2">&quot;keyboard&quot;</span><span class="p">,</span> <span class="s2">&quot;graphic card&quot;</span><span class="p">,</span> <span class="s2">&quot;screen&quot;</span><span class="p">],</span> <span class="s2">&quot;#00FF00&quot;</span><span class="p">);</span>
            <span class="nx">products</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">ProductsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;ProductsWidget&quot;</span><span class="p">,</span>
        <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">products</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">products</span> <span class="o">=</span> <span class="nx">products</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;ProductsWidget&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;widget.products&quot;</span> <span class="na">t-as=</span><span class="s">&quot;product&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;oe_products_item&quot;</span>
                      <span class="na">t-attf-style=</span><span class="s">&quot;background-color: {{ widget.color }};&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;product&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/span&gt;</span>
                <span class="nt">&lt;br/&gt;</span>
            <span class="nt">&lt;/t&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">oe_products_item</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">inline-block</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">black</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<a href="../_images/qweb.png" class="internal alert-link reference"><img src="../_images/qweb.png" class="img-responsive center-block"></a></div></section><section id="widget-helpers"><h2 >Ayudantes de widget</h2></section><section id="widget-s-jquery-selector"><h3 >JQuery Selector de <code >Widget</code></h3><p >Seleccionar elementos del DOM en un widget puede realizarse llamando al método  <code >find()</code> en la raíz del DOM del widget:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
</pre></div>
</div>
<p >But because it's a common operation, <code class="js-class xref js">Widget()</code> provides an
equivalent shortcut through the <code class="js-func xref js">$()</code> method:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<div role="alert" class="alert-warning alert"><p class="alert-title">Advertencia</p><p >La función de jQuery global <code >$()</code> <em >nunca</em> debe ser usada a menos que sea absolutamente necesario: la selección en la raíz de un widget son contextualizadas al widget, pero las selecciones con <code >$()</code> son globales a la página/aplicación y pueden coincidir con piezas de otros widgets y vistas, conduciendo a efectos secundarios peligrosos o no esperados. Desde un widget generalmente debes actuar solamente en la sección del DOM, no debería haber razón alguna para una selección global.</p></div></section><section id="easier-dom-events-binding"><h3 >Asignar eventos del DOM</h3><p >Previamente hemos enlazado eventos DOM usando controladores de eventos normales de jQuery (por ejemplo <code >.click()</code> o <code >.change()</code>) a elementos del widget:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.my_button&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">button_clicked</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Si bien esto funciona tiene algunos problemas:</p><ol ><li ><p >es más bien detallado</p></li><li ><p >no admite sustituir el elemento de raíz del widget en tiempo de ejecución sólo ya que solo se realiza la unión cuando  <code >start()</code> es ejecutado (durante la inicialización del widget)</p></li><li ><p >requiere tratar con los los problemas de <code >this</code>-binding</p></li></ol><p >Widgets thus provide a shortcut to DOM event binding via
<code class="js-attr xref js">events</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;click .my_button&quot;</span><span class="o">:</span> <span class="s2">&quot;button_clicked&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><code class="js-attr xref js">events</code> is an object (mapping) of an event to the
function or method to call when the event is triggered:</p><ul ><li ><p >la clave es el nombre del evento, posiblemente refinado con un selector CSS en cuyo caso sólo si el evento ocurre en un elemento secundario la función se ejecutará: <code >click</code> se encargará de todos los clics dentro del widget, pero <code >click .my_button</code> ejecutará sólo el clic en elementos que tengan la clase <code >my_button</code></p></li><li ><p >el valor es la acción a realizar cuando se desencadena el evento</p><p >Puede ser una función:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* code here */</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p >o el nombre de un método en el objeto (ver ejemplo anterior).</p><p >En cualquier caso, <code >this</code> es la instancia del widget y el controlador pasa un solo parámetro, el <a href="http://api.jquery.com/category/events/event-object/" class="external reference">evento del objeto jQuery</a>.</p></li></ul></section><section id="widget-events-and-properties"><h2 >Propiedades y eventos de widget</h2></section><section id="events"><h3 >Eventos</h3><p >Widgets proporciona un sistema de evento (separado del sistema de eventos de DOM/jQuery descrito): un widget puede disparar eventos en sí mismo, y otros widgets (o a sí mismo) puedes atar a ellos mismos para dichos eventos:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button.ok_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="s1">&#39;click button.cancel_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Are you sure you want to perform this action?&lt;/div&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;ok_button&#39;&gt;Ok&lt;/button&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;cancel_button&#39;&gt;Cancel&lt;/button&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Este widget actúa como una fachada, transformando la entrada del usuario (a través de eventos de DOM) en un evento interno documentable al cual el widget padre se pueden enlazar.</p><p ><code class="js-func xref js">trigger()</code> takes the name of the event to trigger as
its first (mandatory) argument, any further arguments are treated as event
data and passed directly to listeners.</p><p >We can then set up a parent event instantiating our generic widget and
listening to the <code >user_chose</code> event using <code class="js-func xref js">on()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;user_chose&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">user_chose</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">user_chose</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user agreed to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user refused to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><code class="js-func xref js">on()</code> binds a function to be called when the
event identified by <code >event_name</code> is. The <code >func</code> argument is the
function to call and <code >object</code> is the object to which that function is
related if it is a method. The bound function will be called with the
additional arguments of <code class="js-func xref js">trigger()</code> if it has
any. Example:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">my_event_triggered</span><span class="p">);</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">my_event_triggered</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
    <span class="c1">// will print &quot;1 2 3&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >Triggering events on an other widget is generally a bad idea. The main
exception to that rule is <code >odoo.web.bus</code> which exists specifically
to broadcasts evens in which any widget could be interested throughout
the Odoo web application.</p></div></section><section id="properties"><h3 >Propiedades</h3><p >Propiedades son muy similares a atributos normales de objetos que permiten almacenar datos en una instancia del widget, sin embargo tienen la característica adicional que desencadenan eventos cuando son almacenadas:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:name&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name_changed</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Nicolas&quot;</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">name_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The new value of the property &#39;name&#39; is&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<ul ><li ><code class="js-func xref js">set()</code> sets the value of a property and triggers
<code class="samp">change:<em >propname</em></code> (where <em >propname</em> is the property name passed as
first parameter to <code class="js-func xref js">set()</code>) and <code >change</code></li><li ><code class="js-func xref js">get()</code> retrieves the value of a property.</li></ul></section><section id="id3"><h3 >Ejercicio</h3><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Eventos y propiedades del widget</p><p >Crea un widget  <code >ColorInputWidget</code> que desplegará 3 <code >&lt;input type=&quot;text&quot;&gt;</code>. Cada uno de dichos <code >&lt;input&gt;</code> es dedicado a un número hexadecimal de 00 a FF. Cuando cualquiera de esos <code >&lt;input&gt;``es modificado por el usuario el widget de consultar el contenido de esos tres ``&lt;input&gt;</code> concatenar sus valores y lograr un código CSS completo (por ejemplo <code >#00FF00</code>) y colocar el resultado en la propiedad llamada <code >color</code>. Considere que el evento jQuery <code >change()</code> puedes enlazarlo a cualquier elemento HTML <code >input()</code> y el método <code >val()</code> puede consultar el valor actual de dichos <code >&lt;input&gt;</code>, esto será útil para el ejercicio.</p><p >A continuación, modificar el widget <code >HomePage</code> para crear una instancia de  <code >ColorInputWidget</code> y mostrarla. El widget  <code >HomePage</code> también debe mostrar un rectángulo vacío. Ese rectángulo debe siempre, en cualquier momento tener el mismo color de fondo que el color en la propiedad de <code >ColorInputWidget</code> de la instancia de  <code >ColorInputWidget</code>.</p><p >Utilizar QWeb para generar todos los HTML.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">ColorInputWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;ColorInputWidget&quot;</span><span class="p">,</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="s1">&#39;input_changed&#39;</span>
        <span class="p">},</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">input_changed</span><span class="p">();</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="nx">input_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;#&quot;</span><span class="p">,</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_red&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_green&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_blue&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
            <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ColorInputWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">color_changed</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">color_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_div&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">));</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;ColorInputWidget&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Red: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_red&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
            Green: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_green&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
            Blue: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_blue&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_color_div&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">oe_color_div</span> <span class="p">{</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></section><section id="modify-existing-widgets-and-classes"><h2 >Modificar las clases y los widgets existentes</h2><p >The class system of the Odoo web framework allows direct modification of
existing classes using the <code class="js-func xref js">include()</code> method:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">TestClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">TestClass</span><span class="p">.</span><span class="nx">include</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; world&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">TestClass</span><span class="p">().</span><span class="nx">testMethod</span><span class="p">());</span>
<span class="c1">// will print &quot;hello world&quot;</span>
</pre></div>
</div>
<p >Este sistema es similar al mecanismo de la herencia, excepto que alterará la clase objetivo en el mismo lugar sin crear una nueva clase.</p><p >In that case, <code >this._super()</code> will call the original implementation of a
method being replaced/redefined. If the class already had sub-classes, all
calls to <code >this._super()</code> in sub-classes will call the new implementations
defined in the call to <code class="js-func xref js">include()</code>. This will also work
if some instances of the class (or of any of its sub-classes) were created
prior to the call to <code class="js-func xref js">include()</code>.</p></section><section id="translations"><h2 >Traducciones</h2><p >El proceso de traducir texto en código Python y JavaScript es muy similar. Usted pudo haber notado estas líneas al principio del archivo <code >petstore.js</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
    <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
</pre></div>
</div>
<p >Estas líneas se utilizan simplemente para importar las funciones de traducción del módulo actual JavaScript. Se utilizan así:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello user!&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p >In Odoo, translations files are automatically generated by scanning the source
code. All piece of code that calls a certain function are detected and their
content is added to a translation file that will then be sent to the
translators. In Python, the function is <code >_()</code>. In JavaScript the function is
<code class="js-func xref js">_t()</code> (and also <code class="js-func xref js">_lt()</code>).</p><p ><code >_t()</code> devolverá la traducción definida para el texto que se da. Si ninguna traducción se define para ese texto, devuelve el texto original.</p><div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >Para inyectar valores proporcionado por el usuario en cadenas traducibles, es aconsejable utilizar <a href="http://gabceb.github.io/underscore.string.site/#sprintf" class="external reference alert-link">_.str.sprintf</a>  con los argumentos <em >después</em> de la traducción:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">sprintf</span><span class="p">(</span>
    <span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello, %(user)s!&quot;</span><span class="p">),</span> <span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;Ed&quot;</span>
<span class="p">}));</span>
</pre></div>
</div>
<p >Esto hace más legible las cadenas traducibles a los traductores y le da más flexibilidad para ordenar u omitir parámetros.</p></div><p ><code class="js-func xref js">_lt()</code> (&quot;lazy translate&quot;) is similar but somewhat more
complex: instead of translating its parameter immediately, it returns
an object which, when converted to a string, will perform the translation.</p><p >Se utiliza para definir términos traducibles antes de que el sistema de traducción se inicialice, para atributos de la clase por ejemplo (como los módulos se cargan antes de que se configure el idioma del usuario y se descarguen las traducciones lo hace útil).</p></section><section id="communication-with-the-odoo-server"><h2 >Comunicación con el servidor de Odoo</h2></section><section id="contacting-models"><h3 >Ponerse en contacto con modelos</h3><p >La mayoría de las operaciones con Odoo implica comunicarse con <em >modelos</em> implementando operaciones de negocio, estos modelos luego (potencialmente) interactuaran con un motor de almacenamiento (generalmente <a href="http://en.wikipedia.org/wiki/PostgreSQL" class="external reference">PostgreSQL</a>).</p><p >Aunque <a href="http://jquery.org" class="external reference">jQuery</a> provee una función <a href="http://api.jquery.com/jquery.ajax/" class="external reference">$.ajax</a> para las interacciones de la red, comunicarse con Odoo requiere metadatos adicionales cuya configuración antes de cada llamada puede ser propensa a errores. Como resultado, Odoo web ofrece un método de comunicación primitiva de alto nivel.</p><p >Para demostrar esto, el archivo <code >petstore.py</code> contiene un modelo pequeño con un método ejemplo:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">message_of_the_day</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s2">&quot;oepetstore.message_of_the_day&quot;</span>

    <span class="nd">@api.model</span>
    <span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;hello&quot;</span><span class="p">:</span> <span class="s2">&quot;world&quot;</span><span class="p">}</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
</pre></div>
</div>
<p >Esto declara un modelo con dos campos y un método <code >my_method()</code> que devuelve un diccionario literal.</p><p >Aquí está un widget ejemplo que llama a <code >my_method()</code> y muestra el resultado:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">);</span>
        <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
            <span class="c1">// will show &quot;Hello world&quot; to the user</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >The class used to call Odoo models is <code class="js-class xref js">odoo.Model()</code>. It is
instantiated with the Odoo model's name as first parameter
(<code >oepetstore.message_of_the_day</code> here).</p><p ><code class="js-func xref js">call()</code> can be used to call any (public) method of an
Odoo model. It takes the following positional arguments:</p><dl ><dt ><code >name</code></dt><dd ><p >El nombre del método a llamar, <code >my_method</code></p></dd><dt ><code >args</code></dt><dd ><p >un arreglo de  <a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">positional arguments</a> a proporcionar al método. Debido a que el ejemplo no tiene ningún argumento posicional para proporcionar, no se proporciona el parámetro <code >args</code>.</p><p >Aquí está otro ejemplo con argumentos posicionales:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
</div>
</dd><dt ><code >kwargs</code></dt><dd ><p >una asignación de <a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">keyword arguments</a> a pasar. El ejemplo proporciona un solo argumento llamado <code >context</code>.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">c</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
</div>
</dd></dl><p ><code class="js-func xref js">call()</code> returns a deferred resolved with the value
returned by the model's method as first argument.</p></section><section id="compoundcontext"><h3 >CompoundContext</h3><p >La sección anterior utiliza un argumento <code >context</code> que no fue explicado en la llamada al método:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()})</span>
</pre></div>
</div>
<p >El contexto es como un argumento “mágico” que el cliente web siempre le dará al servidor cuando se llama a un método. El contexto es un diccionario que contiene múltiples claves. Uno de los más importantes es el idioma del usuario, el servidor lo utiliza para traducir todos los mensajes de la aplicación. Otra es la zona horaria del usuario, utilizado para calcular correctamente las fechas y horarios si Odoo es utilizado por personas en diferentes países.</p><p >The <code >argument</code> is necessary in all methods, otherwise bad things could
happen (such as the application not being translated correctly). That's why,
when you call a model's method, you should always provide that argument. The
solution to achieve that is to use <code class="js-class xref js">odoo.web.CompoundContext()</code>.</p><p ><code class="js-class xref js">CompoundContext()</code> is a class used to pass the user's
context (with language, time zone, etc...) to the server as well as adding new
keys to the context (some models' methods use arbitrary keys added to the
context). It is created by giving to its constructor any number of
dictionaries or other <code class="js-class xref js">CompoundContext()</code> instances. It will
merge all those contexts before sending them to the server.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">({</span><span class="s1">&#39;new_key&#39;</span><span class="o">:</span> <span class="s1">&#39;key_value&#39;</span><span class="p">})})</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span>
    <span class="o">//</span> <span class="n">will</span> <span class="k">print</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;new_key&#39;</span><span class="p">:</span> <span class="s1">&#39;key_value&#39;</span><span class="p">,</span> <span class="s1">&#39;tz&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe/Brussels&#39;</span><span class="p">,</span> <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p >You can see the dictionary in the argument <code >context</code> contains some keys that
are related to the configuration of the current user in Odoo plus the
<code >new_key</code> key that was added when instantiating
<code class="js-class xref js">CompoundContext()</code>.</p></section><section id="queries"><h3 >Consultas</h3><p >While <code class="js-func xref js">call()</code> is sufficient for any interaction with Odoo
models, Odoo Web provides a helper for simpler and clearer querying of models
(fetching of records based on various conditions):
<code class="js-func xref js">query()</code> which acts as a shortcut for the common
combination of <a href="../reference/orm.html#odoo.models.Model.search" class="internal reference" title="odoo.models.Model.search"><code class="py py-meth xref">search()</code></a> and
:<a href="../reference/orm.html#odoo.models.Model.read" class="internal reference" title="odoo.models.Model.read"><code class="py py-meth xref">read()</code></a>. It provides a clearer syntax to search
and read models:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">])</span>
     <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]])</span>
     <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">all</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do work with users records</span>
<span class="p">});</span>
</pre></div>
</div>
<p >versus:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]],</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ids</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">]]);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do work with users records</span>
    <span class="p">});</span>
</pre></div>
</div>
<ul ><li ><code class="js-func xref js">query()</code> takes an optional list of fields as
parameter (if no field is provided, all fields of the model are fetched). It
returns a <a href="../reference/javascript.html#odoo.web.Query" class="internal reference" title="odoo.web.Query"><code class="js-class xref js">odoo.web.Query()</code></a> which can be further customized before
being executed</li><li ><a href="../reference/javascript.html#odoo.web.Query" class="internal reference" title="odoo.web.Query"><code class="js-class xref js">Query()</code></a> represents the query being built. It is
immutable, methods to customize the query actually return a modified copy,
so it's possible to use the original and the new version side-by-side. See
<a href="../reference/javascript.html#odoo.web.Query" class="internal reference" title="odoo.web.Query"><code class="js-class xref js">Query()</code></a> for its customization options.</li></ul><p >When the query is set up as desired, simply call
<a href="../reference/javascript.html#odoo.web.Query.all" class="internal reference" title="odoo.web.Query.all"><code class="js-func xref js">all()</code></a> to execute it and return a
deferred to its result. The result is the same as
<a href="../reference/orm.html#odoo.models.Model.read" class="internal reference" title="odoo.models.Model.read"><code class="py py-meth xref">read()</code></a>'s, an array of dictionaries where each
dictionary is a requested record, with each requested field a dictionary key.</p></section><section id="exercises"><h2 >Ejercicios</h2><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Mensaje del día</p><p >Crear un widget <code >MessageOfTheDay</code>  que muestre el último registro del modelo <code >oepetstore.message_of_the_day</code>. El widget debe obtener su registro tan pronto como se muestra.</p><p >Mostrar el widget en la página de la tienda de mascotas.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;MessageOfTheDay&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">order_by</span><span class="p">(</span><span class="s1">&#39;-create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;-id&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">first</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_mywidget_message_of_the_day&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">},</span>
    <span class="p">});</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;MessageOfTheDay&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_motd&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;oe_mywidget_message_of_the_day&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">oe_petstore_motd</span> <span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Lista de juguetes para mascotas</p><p >Crear un widget <code >PetToysList</code> mostrando 5 juguetes (usando su nombre y sus imágenes).</p><p >Los juguetes para mascotas no se almacenan en un nuevo modelo, en su lugar se almacenan en la <code >product.product</code> con una categoría especial  <em >Pet Toys</em>. Podrás ver los juguetes previamente generados y añadir nuevos yendo a <span class="menuselection">Pet Store ‣ Pet Store ‣ Pet Toys</span>. Usted probablemente necesitará explorar <code >product.product</code> para crear el dominio adecuado para seleccionar juguetes correctos.</p><p >En Odoo, las imágenes se almacenan generalmente en campos regulares codificados como <a href="http://en.wikipedia.org/wiki/Base64" class="external reference alert-link">base64</a>, HTML soporta mostrar imágenes directamente base64 con <code class="samp">&lt;img src=&quot;data:<em >mime_type</em>;base64,<em >base64_image_data</em>&quot;/&gt;</code></p><p >El widget de  <code >PetToysList</code> debe ser exhibido en la página a la derecha del widget <code >MessageOfTheDay</code>. Usted necesitará hacer algún diseño con CSS para lograrlo.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span>
                <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.oe_petstore_homepage_left&#39;</span><span class="p">)),</span>
                <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.oe_petstore_homepage_right&#39;</span><span class="p">))</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;MessageOfTheDay&#39;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;oepetstore.message_of_the_day&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">order_by</span><span class="p">(</span><span class="s1">&#39;-create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;-id&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">first</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_mywidget_message_of_the_day&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;PetToysList&#39;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;product.product&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;categ_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;Pet Toys&quot;</span><span class="p">]])</span>
                <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">all</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_</span><span class="p">(</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;PetToy&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">item</span><span class="o">:</span> <span class="nx">item</span><span class="p">}));</span>
                    <span class="p">});</span>
                <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage_left&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage_right&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;MessageOfTheDay&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_motd&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;oe_mywidget_message_of_the_day&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToysList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoyslist&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToy&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoy&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;item.name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;p&gt;&lt;img</span> <span class="na">t-att-src=</span><span class="s">&quot;&#39;data:image/jpg;base64,&#39;+item.image&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">oe_petstore_homepage</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">table</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">oe_petstore_homepage_left</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">table-cell</span><span class="p">;</span>
    <span class="k">width</span> <span class="p">:</span> <span class="mi">300</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">oe_petstore_homepage_right</span> <span class="p">{</span>
    <span class="k">display</span><span class="p">:</span> <span class="kc">table-cell</span><span class="p">;</span>
    <span class="k">width</span> <span class="p">:</span> <span class="mi">300</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">oe_petstore_motd</span> <span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">oe_petstore_pettoyslist</span> <span class="p">{</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">oe_petstore_pettoy</span> <span class="p">{</span>
    <span class="k">margin</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">padding</span><span class="p">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border-radius</span><span class="p">:</span> <span class="mi">3</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="p">:</span> <span class="mh">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></section><section id="existing-web-components"><h2 >Componentes de web existentes</h2></section><section id="the-action-manager"><h3 >El director de acción</h3><p >En Odoo, muchas operaciones se inicia desde una <a href="../reference/actions.html#reference-actions" class="internal reference"><span class="std std-ref">acción</span></a>: abrir un elemento de menú (a la vista), imprimir un informe,…</p><p >Las acciones son piezas de información que describen cómo un cliente debe reaccionar a la activación de una pieza de contenido. Las acciones pueden almacenarse (y leer a través de un modelo) o pueden generarse sobre la marcha (localmente en los clientes por código javascript, o remotamente por un método en un modelo).</p><p >En Odoo Web, el componente responsable de manejar y reaccionar a estas acciones es el <em >Action Manager</em>.</p></section><section id="using-the-action-manager"><h4 >Mediante el administrador de la acciones</h4><p >El <em >Action Manager</em> puede ser invocado explícitamente desde código javascript mediante la creación de un diccionario que describe <a href="../reference/actions.html#reference-actions" class="internal reference"><span class="std std-ref">una acción</span></a> del tipo correcto y creando a una instancia <em >Action Manager</em> con el</p><p ><code class="js-func xref js">do_action()</code> is a shortcut of <code class="js-class xref js">Widget()</code>
looking up the &quot;current&quot; action manager and executing the action:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">TestWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">dispatch_to_new_action</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s2">&quot;product.product&quot;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
            <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span>
            <span class="nx">context</span><span class="o">:</span> <span class="p">{},</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >El <code >type</code> más común de acción es <code >ir.actions.act_window</code> que proporciona las vistas de un modelo (recordemos que un modelo se muestra de varias maneras), sus atributos más comunes son:</p><dl ><dt ><code >res_model</code></dt><dd ><p >El modelo del que se muestran las vistas</p></dd><dt ><code >res_id</code> (optional)</dt><dd ><p >Vistas de formulario, un registro pre-seleccionado en <code >res_model</code></p></dd><dt ><code >views</code></dt><dd ><p >Muestra las vistas disponibles a través de la acción. Una lista <code >[view_id, view_type]</code>, <code >view_id</code> puede ser el identificador de base de datos de una vista del tipo correcto, o <code >false</code> a utilizar la vista predeterminada para el tipo especificado. Tipos de vista pueden no estar presentes varias veces. La acción abrirá la primera vista de la lista por defecto.</p></dd><dt ><code >target</code></dt><dd ><p >Cualquiera de los dos <code >current</code> (por defecto) que reemplaza el <code >content</code> de la sección del cliente web por la acción, o <code >new</code> para abrir la acción en un cuadro de diálogo.</p></dd><dt ><code >context</code></dt><dd ><p >Datos de contexto adicional para utilizar dentro de la acción.</p></dd></dl><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Ir al producto</p><p >Modificar el componente <code >PetToysList</code> para hacer clic en un juguete y que reemplace la página principal por vista de formulario de juguete.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;PetToysList&#39;</span><span class="p">,</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click .oe_petstore_pettoy&#39;</span><span class="o">:</span> <span class="s1">&#39;selected_item&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;product.product&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">])</span>
            <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;categ_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;Pet Toys&quot;</span><span class="p">]])</span>
            <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">all</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_</span><span class="p">(</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;PetToy&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">item</span><span class="o">:</span> <span class="nx">item</span><span class="p">}));</span>
                <span class="p">});</span>
            <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">selected_item</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s1">&#39;product.product&#39;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToy&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoy&quot;</span> <span class="na">t-att-data-id=</span><span class="s">&quot;item.id&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;item.name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;&lt;img</span> <span class="na">t-attf-src=</span><span class="s">&quot;data:image/jpg;base64,{{item.image}}&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
</div></section><section id="client-actions"><h3 >Acciones de cliente</h3><p >A lo largo de esta guía, se utilizó un simple widget de <code >HomePage</code> que el cliente web inicia automáticamente cuando selecciona la opción del menú derecho. ¿Pero cómo sabía la Odoo web que tenía que poner este widget? Porque el widget está registrado como una <em >client action</em> (acción del cliente).</p><p >Una acción de cliente es (como su nombre lo indica) un tipo de acción definido casi en su totalidad en el cliente, en javascript para Odoo web. El servidor simplemente envía una etiqueta de acción (un nombre arbitrario) y opcionalmente añade unos pocos parámetros, pero más allá <em >todo</em> es manejado por código personalizado del lado del cliente.</p><p >Nuestro widget está registrada como el controlador de la acción del cliente a través de esto:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p ><code >instance.web.client_actions</code> is a <code class="js-class xref js">Registry()</code> in which
the action manager looks up client action handlers when it needs to execute
one. The first parameter of <code class="js-class xref js">add()</code> is the name
(tag) of the client action, and the second parameter is the path to the widget
from the Odoo web client root.</p><p >Cuando una acción del cliente debe ser ejecutada, el <em >Action Manager</em> busca la etiqueta en el registro, busca la ruta especificada y muestra el widget que encuentra al final.</p><div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><p >un controlador de acción de cliente también puede ser una función regular, en dado caso será llamado y su resultado (si existe) se interpretará como la próxima acción a ejecutar.</p></div><p >En el servidor, simplemente habíamos definido una acción  <code >ir.actions.client</code>:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;action_home_page&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.client&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;tag&quot;</span><span class="nt">&gt;</span>petstore.homepage<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p >y un menú que abre la acción:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;home_page_petstore_menu&quot;</span> <span class="na">parent=</span><span class="s">&quot;petstore_menu&quot;</span>
          <span class="na">name=</span><span class="s">&quot;Home Page&quot;</span> <span class="na">action=</span><span class="s">&quot;action_home_page&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</section><section id="architecture-of-the-views"><h3 >Arquitectura de las vistas</h3><p >Gran parte de la utilidad de la web de Odoo (y complejidad) reside en las vistas. Cada tipo de vista es una forma de mostrar un modelo en el cliente.</p></section><section id="the-view-manager"><h4 >El “<em >View Manager</em>” (Manejador de vistas)</h4><p >Cuando una instancia de <code >ActionManager</code> recibe una acción de tipo <code >ir.actions.act_window</code>, Éste delega la sincronización y manejo de sus vistas a un <em >view manager</em>, el cual configura una o varias vistas dependiendo de los requerimientos de la acción original:</p><a href="../_images/viewarchitecture.svg" class="internal reference"><img src="../_images/viewarchitecture.svg" class="img-responsive center-block"></a></section><section id="the-views"><h4 >Las Vistas</h4><p >Most <a href="../reference/views.html#reference-views" class="internal reference"><span class="std std-ref">Odoo views</span></a> are implemented through a subclass
of <code class="js-class xref js">odoo.web.View()</code> which provides a bit of generic basic structure
for handling events and displaying model information.</p><p >La <em >search view</em> es considerada un tipo de vista para el <em >framework</em> Odoo, pero manejado por separado por el cliente web (ya que es un accesorio más permanente y puede interactuar con otras vistas, no regulares).</p><p >A view is responsible for loading its own description XML (using
<a href="../reference/orm.html#odoo.models.Model.fields_view_get" class="internal reference" title="odoo.models.Model.fields_view_get"><code class="py xref py-class">fields_view_get</code></a>) and any other data source
it needs. To that purpose, views are provided with an optional view
identifier set as the <code class="js-attr xref js">view_id</code> attribute.</p><p >Views are also provided with a <code class="js-class xref js">DataSet()</code> instance which
holds most necessary model information (the model name and possibly various
record ids).</p><p >Views may also want to handle search queries by overriding
<code class="js-func xref js">do_search()</code>, and updating their
<code class="js-class xref js">DataSet()</code> as necessary.</p></section><section id="the-form-view-fields"><h3 >Los campos de la vista formulario</h3><p >Una necesidad común es la extensión de la vista de formulario web para añadir nuevas maneras de mostrar campos.</p><p >All built-in fields have a default display implementation, a new
form widget may be necessary to correctly interact with a new field type
(e.g. a <a href="../glossary.html#term-gis" class="internal reference"><span class="std std-term xref">GIS</span></a> field) or to provide new representations and ways to
interact with existing field types (e.g. validate
<a href="../reference/orm.html#odoo.fields.Char" class="internal reference" title="odoo.fields.Char"><code class="py xref py-class">Char</code></a> fields which should contain email addresses
and display them as email links).</p><p >Para especificar explícitamente de que forma un widget debe ser usado para mostrar un campo, utilice simplemente el atributo de <code >widget</code> en la descripción de XML:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contact_mail&quot;</span> <span class="na">widget=</span><span class="s">&quot;email&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">Nota</p><ul ><li ><p >el mismo widget se utiliza en &quot;view&quot; (sólo lectura) y modo &quot;edition&quot; de una vista de formulario, no es posible utilizar un widget en uno y otro widget en el otro</p></li><li ><p >y un campo dado no puede ser utilizado varias veces en el mismo formulario</p></li><li ><p >un widget puede ignorar el modo de la vista formulario y continuar siendo los mismos en vista y edición</p></li></ul></div><p >Los campos son instanciados por la vista formulario después de leer su descripción desde el XML y construido el HTML correspondiente el cual representa esa descripción. Después de eso, la vista formulario se comunicará con los objetos de campo utilizando algunos métodos. Estos métodos están definidos por la interfaz de ‘’ FieldInterface’’. Casi todos los campos heredan la clase abstracta ‘’ AbstractField’’. Esa clase define algunos mecanismos por defecto que deben aplicarse por la mayoría de los campos.</p><p >Estas son algunas de las responsabilidades de una clase de campo:</p><ul ><li ><p >La clase campo debe mostrar y permitir al usuario editar el valor del campo.</p></li><li ><p >Esto debe implementar correctamente los 3 atributos disponibles en todos los campos en Odoo. La clase <code >AbstractField</code> ya implementa un algoritmo que calcula de forma dinámica los valores de esos 3 atributos (ellos pueden cambiar en cualquier momento su valor de acuerdo al valor de otros campos). Sus valores son almacenados en las “<em >Propiedades del Widget</em>” (las propiedades de un widget fueron explicadas anteriormente en ésta guía). Es responsabilidad de cada clase “Field” chequear esas propiedades en el widget y dinámicamente adaptarse dependiendo de sus valores. Aquí una descripción de cada uno de esos tributos:</p><ul ><li ><p ><code >required</code>: el campo debe tener un valor antes de guardar. Si <code >required</code> es <code >true</code> y el campo no tiene un valor, el método <code >is_valid()</code> del campo debe devolver <code >false</code>.</p></li><li ><p ><code >invisible</code>: cuando éste es <code >true</code>, el campo debe ser invisible. La clase <code >AbstractField</code> ya tiene una implementación básica de este comportamiento que se adapta a la mayoría de los campos.</p></li><li ><p ><code >readonly</code>: Cuando es  <code >true</code>, el campo no debe ser editable por el usuario. La mayoría de los campos de Odoo tiene un comportamiento totalmente diferente dependiendo del valor de  <code >readonly</code>. Como ejemplo, el <code >FieldChar</code> muestra un HTML  <code >&lt;input&gt;</code> cuando es modificable y simplemente muestra el texto cuando es de sólo lectura. Esto también significa que tiene mucho más código que si esto tuviese implementado un sólo comportamiento, pero esto es necesario para asegurar una buena experiencia de usuario.</p></li></ul></li><li ><p >Los campos tienen 2 métodos, <code >set_value()``y ``get_value()`, el cual es llamado por la vista formulario para dar el valor a desplegar y obtener el nuevo valor introducido por el usuario. Esos métodos deben ser capaces de manejar los valores como son dado por el servidor cuando el método ``read()``es usado en un modelo y devolver un valor válido para un ``write()</code>. Recuerda que los tipos usados en Javascript/Python para representar los valores dados por el <code >read()``y por el ``write()``no son necesariamente los mismos en Odoo. Por ejemplo, cuando lees un many2one, éste es siempre una dupla la cual el primer valor el el id del registro y el segundo valor es el nombre (por ejemplo ``(15, “Agrolait”)</code>. Pero cuando escribes un many2one éste debe tener un valor entero simple, no es una tupla. [UNKNOWN NODE title_reference] tiene una implementación de esos métodos que trabaja bien para tipos de daros simples y los carga en una propiedad llamada <code >value</code></p></li></ul><p >Nótese que, para entender mejor cómo implementar campos, encarecidamente es recomendable que leas en la definición de <code >FieldInterface``y la clase ``AbstractField</code> directamente en el código de Odoo Web.</p></section><section id="creating-a-new-type-of-field"><h4 >Crear un nuevo tipo de campo.</h4><p >En ésta parte se explicará como crear un nuevo tipo de campo. El ejemplo de acá será la reimplementación del campo <code >FieldChar</code> y explicar progresivamente cada parte.</p></section><section id="simple-read-only-field"><h5 >Campos solo lectura Simples</h5><p >Aquí está la primera implementación que solo desplegará el texto. El usuario no será capaz de modificar el contenido del campo.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p >En éste ejemplo, declaramos una clase llamada <code >FiledChar2</code> heredando de <code >AbstractField</code>. También agregamos ésta clase al registro <code >instance.web.form.widgets</code> con la llave <code >char2</code>. Esto permitirá que usemos éste nuevo campo en cualquier vista formulario especificando <code >widget=“char2”</code> dentro de una etiqueta <code >&lt;field/&gt;</code> en la declaración XML de la vista.</p><p >En este ejemplo, definimos solo un método: <code >render_value()</code>. Lo que hace es desplegar la propiedad <code >value</code> del widget. Esas son dos herramientas definidas por la clase <code >AbstractField</code>. Como se explicó antes, la vista formulario llamará al método <code >set_value()</code> del campo para establecer el valor a mostrar. <code >AbstractField</code> también vigila el evento <code >change:value</code> y llama a <code >render_value()</code> cuando éste ocurre. Entonces, es un método conveniente para implementar en las clases hijas y hacer operaciones cada vez que el campo cambie.</p><p >En el método <code >init()</code>, también definimos el valor predeterminado del campo si no hay algo especificado es especificado por la vista de formulario (suponemos que el valor predeterminado de un campo <code >char</code>  debe ser una cadena vacía).</p></section><section id="read-write-field"><h5 >Campos de Lectura/Escritura</h5><p >Campos de sólo lectura, que sólo muestran el contenido y no permiten al usuario modificarlo pueden ser útiles, pero la mayoría de campos de Odoo permiten también editar. Esto hace las clases de campos más complicadas, sobre todo porque los campos se supone que deben para manejar ambos tanto editables como no editable, éstos modos son a menudo completamente diferentes (para propósito de diseño y usabilidad) y los campos deben ser capaces de cambiar entre los modos en cualquier momento.</p><p >Para saber en qué modo está el campo actual, la clase de <code >AbstractField</code> establece una propiedad de widget llamada <code >effective_readonly</code>. El campo debe observar cambios en esa propiedad del widget y mostrar el modo correcto en consecuencia. Ejemplo:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldChar2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldChar2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_char2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >En el método <code >start()</code> (el cual es llamado inmediatamente después de que un widget ha sido agregado al DOM), se enlaza el evento <code >change:effective_readonly</code>. Esto nos permite volver a mostrar el campo cada vez que la propiedad del widget <code >effective_readonly``cambia. Éste manejado de evento llamará ``display_field()</code>, el cual es llamado también directamente en <code >start()</code>. El <code >display_field()</code> fué creado específicamente para  éste campo, no es un método definido en <code >AbstractField</code> o cualquier otra clase. Podemos usar éste método para desplegar el contenido del campo en el modo actual.</p><p >De ahora en adelante la concepción de este campo es típica, excepto que hay un montón de comprobaciones para saber el estado de la propiedad <code >effective_readonly</code> :</p><ul ><li ><p >En la plantilla de QWeb usada para mostrar el contenido del widget, se muestra un <code >&lt;input type=&quot;text&quot; /&gt;</code> si estamos en modo de lectura-escritura y nada en particular en modo de sólo lectura.</p></li><li ><p >En el método <code >display_field()</code>, tenemos que enlazar el evento <code >change</code> a el elemento <code >&lt;input type=text/&gt;``para saber cuando el usuario ha cambiado el valor. Cuando esto suceda, llamado a método ``internal_set_value()</code> con el nuevo valor en el campo. Esto es un método conveniente provisto por la clase <code >AbstractField</code>. Dicho método colocará un nuevo valor en la propiedad <code >value``pero no hará una llamada a ``render_value()</code> (la cual no es necesaria ya que <code >&lt;input type=“text”/&gt;</code> contiene el valor correcto)</p></li><li ><p >En <code >render_value()</code>, utilizamos un código totalmente diferente para mostrar el valor del campo en función de si estamos en sólo lectura o en modo de lectura y escritura.</p></li></ul><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Crear un campo de Color</p><p >Crear una clase de <code >FieldColor</code>. El valor de este campo debe ser una cadena que contiene un código de color como los que se usan en CSS (ejemplo: ‘’ #FF0000’’ para el rojo). En modo de sólo lectura, este campo debe mostrar un bloque pequeño cuyo color corresponde al valor del campo. En modo de lectura y escritura, se debe mostrar un <code >&lt;input type=“color”&gt;</code>. Ese tipo de <code >&lt;input&gt;</code> es un componente de HTML5 que no funciona en todos los navegadores pero funciona bien en Google Chrome. Así que está bien para usar como un ejercicio.</p><p >Puede usar este widget en la vista Formulario del modelo <code >message_of_the_day</code> para su campo denominado <code >color</code>. Como un bono, puede cambiar el widget de <code >MessageOfTheDay</code>  en la parte anterior de esta guía para mostrar el mensaje de la jornada con el color de fondo indicado en el campo de <code >color</code>.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">FieldColor</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;effective_readonly&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldColor&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_field_color_content&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldColor&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldColor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_color&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_color_content&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;color&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">oe_field_color_content</span> <span class="p">{</span>
    <span class="k">height</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">width</span><span class="p">:</span> <span class="mi">50</span><span class="kt">px</span><span class="p">;</span>
    <span class="k">border</span><span class="p">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">black</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></section><section id="the-form-view-custom-widgets"><h3 >Los Widgets personalizados en los formularios</h3><p >Los campos de formulario se utilizan para editar un campo y están intrínsecamente ligados a un campo. Porque esto podría ser una limitante, también es posible crear <em >form widgets</em> que no están tan restringidos y tienen menos vínculos a un ciclo de vida específico.</p><p >Widgets de formulario personalizada se pueden agregar a una vista de formulario a través de la etiqueta de <code >widget</code>:</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;widget</span> <span class="na">type=</span><span class="s">&quot;xxx&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p >Este tipo de widget simplemente creará la vista de formulario durante la creación del HTML según la definición de XML. Tienen propiedades en común con los campos (como la propiedad de <code >effective_readonly</code>) pero que no se les asigna un campo preciso. Y por lo que no tienen métodos como <code >get_value()</code> y <code >set_value()</code>. Debe heredar de la clase abstracta <code >FormWidget</code>.</p><p >Form widgets can interact with form fields by listening for their changes and
fetching or altering their values. They can access form fields through
their <code class="js-attr xref js">field_manager</code> attribute:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetMultiplication</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_a&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_b&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_result</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_a&quot;</span><span class="p">)</span> <span class="o">*</span>
                     <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_b&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;a*b = &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;multiplication&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetMultiplication&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p ><code class="js-attr xref js">FormWidget</code> is generally the
<code class="js-class xref js">FormView()</code> itself, but features used from it should
be limited to those defined by <code class="js-class xref js">FieldManagerMixin()</code>,
the most useful being:</p><ul ><li ><code class="js-func xref js">get_field_value(field_name)()</code>
which returns the value of a field.</li><li ><code class="js-func xref js">set_values(values)()</code> sets multiple
field values, takes a mapping of <code >{field_name: value_to_set}</code></li><li ><p >Un evento <code class="samp">field_changed:<em >field_name</em></code> se dispara en cualquier momento que se cambia el valor del campo llamado <code >field_name</code></p></li></ul><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Mostrar coordenadas en Google Maps</p><p >Agregue dos campos a <code >product.product</code> grabando una latitud y una longitud, luego crear un nuevo widget de formulario para mostrar la latitud y longitud de origen de un producto en el mapa</p><p >Para mostrar el mapa, utilice Incrustar Google Map:</p><div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;400&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;300&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll=XXX,YYY&amp;amp;output=embed&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</pre></div>
</div>
<p >donde <code >XXX</code> debe reemplazarse por la latitud y la <code >YYY</code> por la longitud.</p><p >Mostrar los campos de dos posiciones y un widget de mapa utilizando en una nueva pestaña del notebook en la vista de formulario del producto.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetCoordinates</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_latitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_longitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_map</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;WidgetCoordinates&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_latitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_longitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}));</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetCoordinates&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;WidgetCoordinates&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span>
        <span class="na">t-attf-src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll={{latitude}},{{longitude}}&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/iframe&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
</div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Actualizar a la coordenada actual</p><p >Agregar un botón Restablecer coordenadas del producto a la ubicación del usuario, usted puede conseguir estas coordenadas usando el <a href="http://diveintohtml5.info/geolocation.html" class="external reference alert-link">javascript geolocation API</a>.</p><p >Ahora nos gustaría mostrar un botón adicional para configurar automáticamente las coordenadas para la ubicación del usuario actual.</p><p >Para obtener las coordenadas del usuario, una manera fácil es utilizar la API  de geolocalización de JavaScript. <a href="http://www.w3schools.com/html/html5_geolocation.asp" class="external reference alert-link">Ver la documentación online para entender cómo usarla</a>.</p><p >Tenga en cuenta que el usuario no debe poder hacer clic en ese botón cuando la vista de formulario está en modo de sólo lectura. Por lo tanto, este widget personalizado debe manejar correctamente la propiedad  <code >effective_readonly</code> como cualquier campo. Una manera de hacer esto sería hacer el botón desaparece cuando  <code >effective_readonly</code> es [UNKNOWN NODE title_reference].</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetCoordinates</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="s1">&#39;received_position&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">sup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_latitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_longitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">sup</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">display_map</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;WidgetCoordinates&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_latitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_longitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;button&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">));</span>
    <span class="p">},</span>
    <span class="nx">received_position</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">set_values</span><span class="p">({</span>
            <span class="s2">&quot;provider_latitude&quot;</span><span class="o">:</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">,</span>
            <span class="s2">&quot;provider_longitude&quot;</span><span class="o">:</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetCoordinates&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;WidgetCoordinates&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span>
        <span class="na">t-attf-src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll={{latitude}},{{longitude}}&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/iframe&gt;</span>
    <span class="nt">&lt;button&gt;</span>Get My Current Coordinate<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
</div><div class="footnote" id="id4"><span class="footnote-label"><a class="footnote-backref" href="#id1">[1]</a></span> <p >como un concepto separado de las instancias. En muchos lenguajes las clases son objetos (metaclases) y a su vez tienes instancias de si mismos sin embargo siguen siendo dos jerarquías bastante separadas entre clases e instancias</p></div><div class="footnote" id="dombugs"><span class="footnote-label"><a class="footnote-backref" href="#id2">[2]</a></span> <p >como empapelar sobre las diferencias entre navegadores, aunque esto es menos necesario en el tiempo</p></div></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
    </div>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="http://www.odoo.com/pricing">Editions</a></li>
                <li><a href="http://www.odoo.com/pricing-online">Cloud Pricing</a></li>
                <li><a href="http://www.odoo.com/page/upgrade">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog/">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  </body>
</html>